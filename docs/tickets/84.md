## **ASTR-84: Core API Endpoints (P1) - API layer**

### **Context & Current State**
The FastAPI application structure exists in `src/adapters/api/main.py` with basic routing, but the core domain endpoints need implementation. This is a critical P1 ticket that provides the API interface for all domains.

### **Technical Requirements**

**Dependencies**: ASTR-73 (Observation Models) - Pending, ASTR-81 (Anomaly Detection) - Pending
**Domain**: API Domain
**Estimated Time**: 4 days

### **Implementation Tasks**

1. **Implement Observations Endpoints**
   - Complete `src/domains/observations/api/routes.py`
   - Add endpoints:
     - `POST /observations` - Create observation
     - `GET /observations/{id}` - Get observation details
     - `GET /observations` - List observations with filtering
     - `PUT /observations/{id}/status` - Update status
     - `GET /observations/search` - Search by coordinates
   - Add proper error handling and validation
   - Implement pagination and sorting

2. **Add Detections Endpoints**
   - Create `src/domains/detection/api/routes.py`
   - Add endpoints:
     - `POST /detections/infer` - Run ML inference
     - `GET /detections/{id}` - Get detection details
     - `GET /detections` - List detections with filtering
     - `PUT /detections/{id}/validate` - Human validation
     - `GET /detections/statistics` - Detection statistics
   - Add confidence scoring and filtering
   - Implement real-time detection streaming

3. **Create Streaming Endpoints (SSE)**
   - Enhance `src/adapters/api/routes/stream.py`
   - Add Server-Sent Events for:
     - Real-time detection updates
     - Processing status updates
     - System health monitoring
   - Implement connection management and error handling
   - Add authentication for streaming endpoints

4. **Add Health Check and Monitoring Endpoints**
   - Create `src/adapters/api/routes/health.py`
   - Add endpoints:
     - `GET /health` - Basic health check
     - `GET /health/detailed` - Detailed system status
     - `GET /health/dependencies` - External service status
     - `GET /metrics` - System metrics (if Prometheus enabled)
   - Add database connectivity checks
   - Add external service health monitoring

### **API Design Patterns**

**Response Format**:
```python
{
  "success": true,
  "data": {...},
  "message": "Operation completed successfully",
  "timestamp": "2025-01-27T10:30:00Z",
  "request_id": "req_123456"
}
```

**Error Format**:
```python
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid coordinates provided",
    "details": {...}
  },
  "timestamp": "2025-01-27T10:30:00Z",
  "request_id": "req_123456"
}
```

### **Authentication & Authorization**
- Integrate with Supabase JWT authentication
- Implement role-based access control
- Add API key management for service-to-service calls
- Create permission-based endpoint protection

### **API Documentation**
- Complete OpenAPI/Swagger documentation
- Add comprehensive examples
- Include error response documentation
- Add authentication requirements

### **Testing Strategy**
- Unit tests for all endpoints
- Integration tests with database
- Load testing for high-traffic endpoints
- API contract testing

### **Performance Requirements**
- Response time < 200ms for 95% of requests
- Support for 100+ concurrent users
- Proper caching for frequently accessed data
- Database query optimization